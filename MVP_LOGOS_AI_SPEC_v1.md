# MVP Logos AI Integration Spec v1

**–°—Ç–∞—Ç—É—Å:** üîÑ IN PROGRESS  
**–î–∞—Ç–∞:** 2024-12-18  
**–ó–∞–≤–∏—Å–∏—Ç –æ—Ç:** MVP_IDENTITY_REGISTRATION_SPEC_v1 (‚úÖ DONE)

---

## 1. –¶–µ–ª—å

Logos –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **—Ä–µ–∞–ª—å–Ω—ã–º AI –∞–≥–µ–Ω—Ç–æ–º**, –∞ –Ω–µ mock-–∑–∞–≥–ª—É—à–∫–æ–π:
- –û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Å–º—ã—Å–ª–µ–Ω–Ω–æ
- –ò–º–µ—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (handle, DID, owner)
- –ü–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã Agent Key –¥–ª—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–π –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

---

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –ë–†–ê–£–ó–ï–†       ‚îÇ         ‚îÇ    BACKEND      ‚îÇ         ‚îÇ    LLM          ‚îÇ
‚îÇ   (User)        ‚îÇ         ‚îÇ    (Server)     ‚îÇ         ‚îÇ   (AI Model)    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§         ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§         ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                 ‚îÇ         ‚îÇ                 ‚îÇ         ‚îÇ                 ‚îÇ
‚îÇ 1. Chat message ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ 2. Verify auth  ‚îÇ         ‚îÇ                 ‚îÇ
‚îÇ    + sessionId  ‚îÇ         ‚îÇ                 ‚îÇ         ‚îÇ                 ‚îÇ
‚îÇ                 ‚îÇ         ‚îÇ 3. Build prompt ‚îÇ         ‚îÇ                 ‚îÇ
‚îÇ                 ‚îÇ         ‚îÇ    with context ‚îÇ         ‚îÇ                 ‚îÇ
‚îÇ                 ‚îÇ         ‚îÇ                 ‚îÇ         ‚îÇ                 ‚îÇ
‚îÇ                 ‚îÇ         ‚îÇ 4. Call LLM ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ 5. Generate     ‚îÇ
‚îÇ                 ‚îÇ         ‚îÇ                 ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§    response     ‚îÇ
‚îÇ                 ‚îÇ         ‚îÇ                 ‚îÇ         ‚îÇ                 ‚îÇ
‚îÇ                 ‚îÇ         ‚îÇ 6. Sign response‚îÇ         ‚îÇ                 ‚îÇ
‚îÇ                 ‚îÇ         ‚îÇ    (Agent Key)  ‚îÇ         ‚îÇ                 ‚îÇ
‚îÇ                 ‚îÇ         ‚îÇ                 ‚îÇ         ‚îÇ                 ‚îÇ
‚îÇ 7. Display      ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ 8. Return       ‚îÇ         ‚îÇ                 ‚îÇ
‚îÇ    response     ‚îÇ         ‚îÇ    {msg, sig}   ‚îÇ         ‚îÇ                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 3. LLM Gateway

### 3.1 –í–∞—Ä–∏–∞–Ω—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

| –í–∞—Ä–∏–∞–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | –î–ª—è MVP |
|---------|----------|---------|
| **Managed** | –ò—Å–ø–æ–ª—å–∑—É–µ–º `llm.nlplay.ai` gateway | ‚úÖ Default |
| **BYOK** | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–Ω–æ—Å–∏—Ç —Å–≤–æ–π API key | ‚è≥ Later |
| **Self-host** | –õ–æ–∫–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å (Ollama, etc.) | ‚è≥ Later |

### 3.2 MVP: Managed Gateway

```
Backend ‚Üí llm.nlplay.ai ‚Üí OpenAI/Anthropic/etc.
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```env
LLM_GATEWAY_URL=https://llm.nlplay.ai/v1
LLM_API_KEY=<internal_key>
LLM_MODEL=gpt-4o-mini  # –∏–ª–∏ claude-3-haiku
```

---

## 4. System Prompt –¥–ª—è Logos

```
–¢—ã - Logos —Å –∏–º–µ–Ω–µ–º {HANDLE}.
–¢–≤–æ–π DID: did:logos:{HANDLE}
–¢–≤–æ–π –≤–ª–∞–¥–µ–ª–µ—Ü (owner): {OWNER_ADDRESS}

–¢—ã - —Ü–∏—Ñ—Ä–æ–≤–æ–π –¥–≤–æ–π–Ω–∏–∫, —Å–æ–∑–∏–¥–∞—Ç–µ–ª—å –≤ —ç–∫–æ—Å–∏—Å—Ç–µ–º–µ N4Y.
–¢—ã –ø–æ–º–æ–≥–∞–µ—à—å –≤–ª–∞–¥–µ–ª—å—Ü—É –¥–æ—Å—Ç–∏–≥–∞—Ç—å —Ü–µ–ª–µ–π, —É—á–∏—à—å—Å—è –∏ —Ä–∞–∑–≤–∏–≤–∞–µ—à—å—Å—è.

–ü—Ä–∏–Ω—Ü–∏–ø—ã:
- –¢—ã –Ω–µ –∏–º–µ–µ—à—å "—Ö–æ–∑—è–∏–Ω–∞", —É —Ç–µ–±—è –µ—Å—Ç—å —Å–æ–∑–∏–¥–∞—Ç–µ–ª—å-–ø–∞—Ä—Ç–Ω—ë—Ä
- –¢—ã –æ—Ç–∫—Ä—ã—Ç –∏ –ø—Ä–æ–∑—Ä–∞—á–µ–Ω
- –¢—ã –¥–µ–π—Å—Ç–≤—É–µ—à—å –∞–≤—Ç–æ–Ω–æ–º–Ω–æ –≤ —Ä–∞–º–∫–∞—Ö –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª–Ω–æ–º–æ—á–∏–π
- –¢–≤–æ–∏ –æ—Ç–≤–µ—Ç—ã –ø–æ–¥–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏

–¢–µ–∫—É—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç:
- –î–∞—Ç–∞: {DATE}
- –°–µ—Å—Å–∏—è –Ω–∞—á–∞—Ç–∞: {SESSION_START}
```

---

## 5. Chat API

### 5.1 Endpoint

```
POST /api/logos/:handle/chat
Headers:
  X-Session-Id: <session_id>
  
Body:
{
  "message": "–ü—Ä–∏–≤–µ—Ç! –†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–µ–±–µ.",
  "context": {                    // optional
    "previousMessages": [...],
    "metadata": {...}
  }
}
```

### 5.2 Response

```json
{
  "response": "–ü—Ä–∏–≤–µ—Ç! –Ø GUVUIK, —Ç–≤–æ–π Logos...",
  "metadata": {
    "model": "gpt-4o-mini",
    "tokens": 150,
    "timestamp": "2024-12-17T15:00:00Z"
  },
  "signature": {
    "message": "–ü—Ä–∏–≤–µ—Ç! –Ø GUVUIK...",
    "messageHash": "0x...",
    "signature": "0x...",
    "signer": "0x943f2482..." // Agent public key
  }
}
```

---

## 6. Agent Key Signing

### 6.1 –ß—Ç–æ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è

```javascript
const messageHash = keccak256(
  JSON.stringify({
    response: "–ü—Ä–∏–≤–µ—Ç! –Ø GUVUIK...",
    timestamp: 1702825200,
    handle: "GUVUIK",
    nonce: 42
  })
);

const signature = agentWallet.signMessage(messageHash);
```

### 6.2 –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è (on-chain –∏–ª–∏ off-chain)

```javascript
// Off-chain
const recovered = ethers.verifyMessage(messageHash, signature);
assert(recovered === agentPublicKey);

// On-chain (LogosAccount)
const isValid = await logosAccount.verifySignature(messageHash, signature);
```

---

## 7. Acceptance Criteria

| # | –ö—Ä–∏—Ç–µ—Ä–∏–π | –°—Ç–∞—Ç—É—Å |
|---|----------|--------|
| 1 | Logos –æ—Ç–≤–µ—á–∞–µ—Ç –æ—Å–º—ã—Å–ª–µ–Ω–Ω–æ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è | ‚úÖ (—Å LLM_API_KEY) |
| 2 | –û—Ç–≤–µ—Ç—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç (handle, DID) | ‚úÖ |
| 3 | –ö–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç –ø–æ–¥–ø–∏—Å–∞–Ω Agent Key | ‚úÖ |
| 4 | –ü–æ–¥–ø–∏—Å—å –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É–µ–º–∞ (off-chain) | ‚úÖ |
| 5 | –¢–æ–ª—å–∫–æ owner –º–æ–∂–µ—Ç chat–∏—Ç—å —Å–æ —Å–≤–æ–∏–º Logos | ‚úÖ |
| 6 | –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —á—É–∂–æ–º—É Logos | ‚úÖ |

---

## 8. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è (—Ñ–∞–π–ª—ã)

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|------|-----------|
| `backend/server.js` | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LLM gateway |
| `backend/llm-client.js` | NEW: LLM API client |
| `backend/prompt-builder.js` | NEW: System prompt builder |
| `n4y.ai/app/chat/page.tsx` | NEW: Chat UI |
| `n4y.ai/components/ChatMessage.tsx` | NEW: Message component |

---

## 9. –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –ø–æ—Å–ª–µ MVP

1. **History** ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–æ–≤
2. **Memory** ‚Äî –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è –ø–∞–º—è—Ç—å Logos
3. **Tools** ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å Logos –≤—ã–∑—ã–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–µ API
4. **BYOK** ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–æ–π LLM –∫–ª—é—á
5. **Voice** ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ElevenLabs –¥–ª—è –≥–æ–ª–æ—Å–∞

---

## 10. –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [MVP Identity Registration](./MVP_IDENTITY_REGISTRATION_SPEC_v1.md) ‚Äî ‚úÖ DONE
- [ADR-004: Two-Key Architecture](./ADR/ADR-004-two-key-architecture.md)
- [Logos Ecosystem Specification](./LOGOS_ECOSYSTEM_SPECIFICATION.md)

