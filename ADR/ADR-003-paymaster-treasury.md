# ADR-003: Paymaster –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ registerName; —Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑ 2-of-3 Treasury multisig

## –°—Ç–∞—Ç—É—Å
üü° **–ü—Ä–∏–Ω—è—Ç–æ, –æ–∂–∏–¥–∞–µ—Ç –¥–µ–ø–ª–æ—è** (2024-12-17)

> **–ë–ª–æ–∫–µ—Ä:** Treasury —Ç—Ä–µ–±—É–µ—Ç 3 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∞–¥—Ä–µ—Å–∞ –¥–ª—è 2-of-3 multisig.
> –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥—Ä–µ—Å–æ–≤ ‚Äî –¥–µ–ø–ª–æ–π Treasury –∏ Paymaster.

## –ì–æ—Ç–æ–≤—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã (–Ω–µ –∑–∞–¥–µ–ø–ª–æ–µ–Ω—ã)

| –ö–æ–Ω—Ç—Ä–∞–∫—Ç | –ü—É—Ç—å | –¢–µ—Å—Ç—ã |
|----------|------|-------|
| TreasuryMultisig2of3 | `logos-protocol/contracts/core/TreasuryMultisig2of3.sol` | ‚úÖ |
| LogosRegisterPaymaster | `logos-protocol/contracts/core/LogosRegisterPaymaster.sol` | ‚úÖ |

## –ö–æ–Ω—Ç–µ–∫—Å—Ç
–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è MVP:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å **–Ω–µ –¥–æ–ª–∂–µ–Ω –ø–æ–∫—É–ø–∞—Ç—å –∫—Ä–∏–ø—Ç—É/–≥–∞–∑** –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏–º–µ–Ω–∏.
- –ò—Å–ø–æ–ª—å–∑—É–µ–º **Account Abstraction + Paymaster**.
- Paymaster –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç –≥–∞–∑ **—Ç–æ–ª—å–∫–æ** –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏–º–µ–Ω–∏ (`registerName`).
- –§–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ paymaster –∏–¥—ë—Ç –∏–∑ **on-chain Treasury**, —É–ø—Ä–∞–≤–ª—è–µ–º–æ–π **2-of-3 –º—É–ª—å—Ç–∏—Å–∏–≥–æ–º** (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–∑–∏–¥–∞—Ç–µ–ª–µ–π).
- –ù–∏–∫–∞–∫–∏—Ö —Ä—É—á–Ω—ã—Ö allowlist/ban –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º; –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è ‚Äî —Ç–æ–ª—å–∫–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–∏–µ –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ.

**–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∏—Å—Ç–∏–Ω—ã:**
- `n4y.ai/logos/.ai-knowledge.md` ‚Äî —Ä–∞–∑–¥–µ–ª **6**
- `n4y.ai/logos/MVP_IDENTITY_REGISTRATION_SPEC_v1.md` ‚Äî —Ä–∞–∑–¥–µ–ª—ã **7.2**, **7.3**, **9.2**, **10**, **11**

## –†–µ—à–µ–Ω–∏–µ
### 1) Paymaster
–ò—Å–ø–æ–ª—å–∑—É–µ–º ERC‚Äë4337 paymaster, –∫–æ—Ç–æ—Ä—ã–π **–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏**, –∞ –Ω–µ ‚Äú–∫—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å‚Äù.

–ê–ª–≥–æ—Ä–∏—Ç–º –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–≤ `validatePaymasterUserOp` / —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–µ):
- –î–µ–∫–æ–¥–∏—Ä—É–µ–º calldata —Ü–µ–ª–µ–≤–æ–≥–æ –≤—ã–∑–æ–≤–∞ –∞–∫–∫–∞—É–Ω—Ç–∞ –∏ —É–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ:
  - —Ü–µ–ª–µ–≤–æ–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç = `NameRegistry`,
  - —Å–µ–ª–µ–∫—Ç–æ—Ä —Ñ—É–Ω–∫—Ü–∏–∏ = `registerName(string)` (–∏–ª–∏ —Ç–æ—á–Ω–∞—è —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ MVP),
  - –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¥—Ä—É–≥–∏—Ö –≤—ã–∑–æ–≤–æ–≤/–±–∞—Ç—á–∏–Ω–≥–∞ (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ).
- –õ—é–±–∞—è –¥—Ä—É–≥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è ‚Äî **–æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è** (paymaster –Ω–µ –ø–ª–∞—Ç–∏—Ç).

### 2) Treasury (2-of-3 multisig)
–î–µ–ª–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é on-chain –∫–∞–∑–Ω—É `TreasuryMultisig2of3`:
- 3 –≤–ª–∞–¥–µ–ª—å—Ü–∞ (addresses), –ø–æ—Ä–æ–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π = 2.
- –ú–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å ETH –Ω–∞:
  - –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–ø–æ–∑–∏—Ç–∞ paymaster/EntryPoint (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π AA —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏),
  - (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ø—Ä—è–º–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ paymaster –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞, –µ—Å–ª–∏ –æ–Ω –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞.
- –ù–∏–∫–∞–∫–∏—Ö ‚Äú–ø–æ–ª–∏—Ç–∏–∫ –¥–æ—Å—Ç—É–ø–∞‚Äù –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º; –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–æ–ª—å –∫–∞–∑–Ω—ã ‚Äî —É–ø—Ä–∞–≤–ª—è—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ —Å—É–±—Å–∏–¥–∏–∏.

## –ü–æ—á–µ–º—É —ç—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–ø–µ–∫–∞–º
- –°—É–±—Å–∏–¥–∏—è –≥–∞–∑–∞ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ paymaster –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∫—Ä–∏–ø—Ç—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å–º. `.ai-knowledge.md` ¬ß6).
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ ‚Äú–ø–ª–∞—Ç–∏–º —Ç–æ–ª—å–∫–æ –∑–∞ registerName‚Äù ‚Äî —Ñ–æ—Ä–º–∞–ª—å–Ω–æ–µ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º–æ–µ (—Å–º. `MVP_IDENTITY_REGISTRATION_SPEC_v1.md` ¬ß7.3, ¬ß10).
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ–Ω–¥–æ–º –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ–¥–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ (2-of-3, —Å–º. ¬ß7.2).

## –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è
- –°–ø–æ–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ –æ–¥–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π; —Å–ø–∞–º –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç—Å—è —ç–∫–æ–Ω–æ–º–∏–∫–æ–π —Å–µ—Ç–∏ –∏ –ª–∏–º–∏—Ç–∞–º–∏ paymaster –ø–æ —Ç–∏–ø—É –æ–ø–µ—Ä–∞—Ü–∏–∏, –±–µ–∑ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –±–∞–Ω–æ–≤.
- –¢—Ä–µ–±—É–µ—Ç—Å—è –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è treasury –∏ –¥–µ–ø–æ–∑–∏—Ç–∞ paymaster (–≤–Ω–µ MVP‚ÄëUX).

## Acceptance criteria (–ø—Ä–æ–≤–µ—Ä—è–µ–º–æ)
- UserOp, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Ç–æ–ª—å–∫–æ –≤—ã–∑–æ–≤ `NameRegistry.registerName(...)`, —É—Å–ø–µ—à–Ω–æ —Å–ø–æ–Ω—Å–∏—Ä—É–µ—Ç—Å—è paymaster.
- –õ—é–±–æ–π –¥—Ä—É–≥–æ–π –≤—ã–∑–æ–≤ (–¥—Ä—É–≥–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –¥—Ä—É–≥–æ–π target, –±–∞—Ç—á) ‚Äî –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è paymaster.
- Treasury —Ç—Ä–µ–±—É–µ—Ç 2 –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏–∑ 3 –¥–ª—è –≤—ã–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ paymaster/EntryPoint.


