# ADR-001: Controller Логоса в MVP (ERC-4337 Smart Account)

## Статус
✅ **Принято** (2024-12-17)

> **Примечание:** В текущей реализации MVP контроллером является EOA (внешний аккаунт).
> ERC-4337 Smart Account будет добавлен вместе с Paymaster для gasless регистрации.

## Контекст
В MVP необходимо:
- создать “контроллер” Логоса, который будет подписывать действия;
- скрывать от пользователя адреса/chainId/технические детали (UI показывает только handle);
- обеспечить регистрацию handle **без покупки газа пользователем** через **Account Abstraction + Paymaster**.

**Источники истины:**
- `n4y.ai/logos/.ai-knowledge.md` — разделы **3**, **4**, **6**
- `n4y.ai/logos/MVP_IDENTITY_REGISTRATION_SPEC_v1.md` — разделы **2**, **5**, **7.3**, **9.1–9.2**, **11**, **12**

## Решение
В MVP **Controller = ERC‑4337 Smart Account** (смарт‑аккаунт пользователя), а операции регистрации имени выполняются через UserOperation, которую спонсирует Paymaster.

- Контроллер (адрес) = адрес смарт‑аккаунта.
- `NameRegistry` регистрирует `handle → controller`, где `controller = msg.sender` (смарт‑аккаунт).
- UI не отображает адрес/chainId; в интерфейсе показываем только handle.

## Почему это соответствует спекам
- Спека явно требует **AA + Paymaster** для отсутствия “газа” у пользователя (см. `.ai-knowledge.md` §6 и `MVP_IDENTITY_REGISTRATION_SPEC_v1.md` §7.3, §9.2, §11).
- Не вводит ручных политик/контроля: никаких allowlist/банов пользователей, только формальная проверка типа операции на стороне paymaster (это отдельный ADR-003).

## Последствия
- Нужны стандартные ERC‑4337 компоненты (EntryPoint, аккаунт/фабрика) для dev/test и интеграции с bundler.
- Для MVP допускаем упрощённый локальный сценарий (локальная сеть/базовая конфигурация) при условии, что on-chain части и правила субсидии формально выражены.

## Acceptance criteria (проверяемо)
- Можно создать контроллер (смарт‑аккаунт) и выполнить userOp, где целевой вызов — регистрация handle.
- UI не обязан показывать адрес/chainId; в MVP отображается только handle (см. `MVP_IDENTITY_REGISTRATION_SPEC_v1.md` §5).


